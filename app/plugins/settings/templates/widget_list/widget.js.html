<script>
    $(function () {
        $('#settings-form').submit(function (e) {
            e.preventDefault();
            var $theForm = $(this);

            var settings = {};
            $('.setting').each(function (i, panel) {
                console.log($(this).data('slug'));
                console.log($(this).find('select, textarea, input').serializeArray());
                settings[$(this).data('slug')] = $(this).find('select, textarea, input').serializeArray();
            });
            var data = {
                settings: JSON.stringify(settings),
                category: '{{ category }}'
            };
            console.log(data);
            $.ajax({
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token() }}");
                },
                type: 'POST',
                url: '{{ url_for('.submit_settings') }}',
                data: data,
                success: function (msg) {
                    location.reload();
                }
            });
        });
        $('.fa-arrow-up').click(function (event) {
            var e = $(this).parent();
            e.prev().insertAfter(e);
        });
        $('.fa-arrow-down').click(function (event) {
            var e = $(this).parent();
            e.next().insertBefore(e);
        })
    })
</script>