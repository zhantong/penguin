{% extends "base.html" %}
{% import "_panel-macros.html" as panels %}

{% block title %}{{ post.title }} - Penguin{% endblock %}

{% block metas %}
    {{ super() }}
    <meta name="description" content="{{ post.body_abstract[:100]|replace('\n',' ') }}"/>
    <meta name="keywords" content="{{ post.categories_and_tags_string() }}"/>
    <meta name="author" content="{{ post.author.name }}"/>
{% endblock %}

{% block styles %}
    {{ super() }}
    {{ panels.toc_style() }}
{% endblock %}

{% block main %}
    <article>
        <h1>{{ post.title }}</h1>
        <div>
            {% include article_content %}
        </div>
    </article>
    {% for content in contents %}
        {% include content %}
    {% endfor %}
{% endblock %}

{% block sidebar_left %}
    {{ panels.toc(post) }}
{% endblock %}

{% block scripts %}
    {{ super() }}
    {{ panels.toc_script() }}
    <script>
        $('a.reply-comment').click(function (event) {
            event.preventDefault();
            $('#new-comment').detach().insertAfter($(event.target).parent());
            console.log($(event.target));
            $('#comment-parent').val($(event.target).data('parent'));
        });
        $('#comment-submit').click(function (event) {
            event.preventDefault();
            $(this).prop('disabled', true);
            $.ajax({
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token() }}");
                },
                type: 'POST',
                url: '{{ url_for('.submit_comment',id=post.id) }}',
                data: {
                    parent: $('#comment-parent').val(),
                    name: $('#comment-name').val(),
                    email: $('#comment-email').val(),
                    body: $('#comment-body').val(),
                    success: function (msg) {
                        location.reload();
                    }
                }
            });
        })
    </script>
{% endblock %}