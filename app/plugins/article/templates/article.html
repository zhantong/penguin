{% extends "base.html" %}

{% block title %}{{ article.title }} - Penguin{% endblock %}

{% block metas %}
    {{ super() }}
    <meta name="description" content="{{ article.body_abstract[:100]|replace('\n',' ') }}"/>
    {% set keywords=[] %}
    {% for category in article.categories %}
        {% do keywords.append(category.get_info()['name']) %}
    {% endfor %}
    {% for tag in article.tags %}
        {% do keywords.append(tag.get_info()['name']) %}
    {% endfor %}
    <meta name="keywords" content="{{ keywords|join(',') }}"/>
    <meta name="author" content="{{ article.author.name }}"/>
{% endblock %}

{% block styles %}
    {{ super() }}
    {% for style in styles %}
        {{ style|safe }}
    {% endfor %}
    <style type="text/css">
        article img {
            max-width: 100%;
            box-sizing: border-box;
        }

        code {
            word-break: break-word;
        }

        article > ul.meta {
            padding: 0;
            list-style: none;
            display: flex;
            justify-content: space-between;
        }
    </style>
{% endblock %}

{% block main %}
    <article class="post">
        <h1>{{ article.title }}</h1>
        <ul class="meta">
            <li>
                <i class="fa fa-calendar fa-fw" title="发表时间"></i>
                {{ moment(article.timestamp).format('L') }}
            </li>
            <li>
                <i class="fa fa-share-alt fa-fw" title="短链接"></i>
                {{ url_for('.show_article_by_number', number=article.number, _external=True) }}
            </li>
            <li>
                <i class="fa fa-bookmark fa-fw" title="分类"></i>
                {% for category in article.categories %}
                    {% set category_info=category.get_info() %}
                    <a href="{{ category_info['url'] }}">{{ category_info['name'] }}</a>
                    {% if not loop.last %}
                        ,
                    {% endif %}
                {% endfor %}
            </li>
            <li>
                <i class="fa fa-tag fa-fw" title="标签"></i>
                {% for tag in article.tags %}
                    {% set tag_info=tag.get_info() %}
                    <a href="{{ tag_info['url'] }}">{{ tag_info['name'] }}</a>
                    {% if not loop.last %}
                        ,
                    {% endif %}
                {% endfor %}
            </li>
            <li>
                <i class="fa fa-comment fa-fw" title="评论数"></i>
                <span class="badge">{{ article.comments|length }}</span>
            </li>
            <li>
                <i class="fa fa-heart fa-fw" title="阅读量"></i>
                <span class="badge">{{ article.article_count.get_view_count() }}</span>
            </li>
        </ul>
        <div>
            {{ article.body_html | safe }}
        </div>
    </article>
    {{ rendered_comments|safe }}
{% endblock %}

{% block sidebar_left %}
    {% for left_widget in left_widgets %}
        {{ left_widget|safe }}
    {% endfor %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    {% for script in scripts %}
        {{ script|safe }}
    {% endfor %}
{% endblock %}